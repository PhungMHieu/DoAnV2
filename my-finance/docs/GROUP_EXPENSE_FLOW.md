# ğŸ“Š Luá»“ng Chia Tiá»n Theo NhÃ³m (Group Expense)

## Tá»•ng Quan

Há»‡ thá»‘ng chia tiá»n theo nhÃ³m cho phÃ©p ngÆ°á»i dÃ¹ng:
- Táº¡o nhÃ³m vá»›i cÃ¡c thÃ nh viÃªn
- Ghi nháº­n chi tiÃªu chung
- Tá»± Ä‘á»™ng chia tiá»n theo nhiá»u cÃ¡ch
- TÃ­nh toÃ¡n ai ná»£ ai vÃ  rÃºt gá»n ná»£

---

## ğŸ—ï¸ Kiáº¿n TrÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API Gateway                                  â”‚
â”‚                        (Port 3000)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                  â”‚
               â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Group Service        â”‚        â”‚     Transaction Service          â”‚
â”‚      (Port 3004)         â”‚        â”‚        (Port 3001)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Quáº£n lÃ½ nhÃ³m           â”‚        â”‚ â€¢ Quáº£n lÃ½ chi tiÃªu nhÃ³m          â”‚
â”‚ â€¢ Quáº£n lÃ½ thÃ nh viÃªn     â”‚        â”‚ â€¢ Chia tiá»n (equal/exact/percent)â”‚
â”‚ â€¢ Join/Leave nhÃ³m        â”‚        â”‚ â€¢ TÃ­nh balance                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ RÃºt gá»n ná»£ (simplify)          â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Database Schema

### Group Service

```sql
-- Báº£ng groups
CREATE TABLE groups (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(10) UNIQUE NOT NULL,      -- MÃ£ má»i tham gia
    created_by_user_id VARCHAR(255) NOT NULL,
    is_locked BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Báº£ng group_members
CREATE TABLE group_members (
    id SERIAL PRIMARY KEY,
    group_id UUID REFERENCES groups(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,            -- TÃªn hiá»ƒn thá»‹ trong nhÃ³m
    user_id VARCHAR(255),                  -- NULL náº¿u chÆ°a join
    joined BOOLEAN DEFAULT FALSE,
    joined_at TIMESTAMPTZ
);
```

### Transaction Service (Group Expense)

```sql
-- Báº£ng group_expenses (chi tiÃªu nhÃ³m)
CREATE TABLE group_expenses (
    id UUID PRIMARY KEY,
    group_id UUID NOT NULL,                -- FK logical Ä‘áº¿n groups
    title VARCHAR(255) NOT NULL,
    amount NUMERIC(18,2) NOT NULL,
    paid_by_member_id VARCHAR(255) NOT NULL,  -- Ai tráº£ tiá»n
    created_by_user_id VARCHAR(255) NOT NULL,
    split_type VARCHAR(20) DEFAULT 'equal',   -- equal | exact | percent
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Báº£ng group_expense_shares (pháº§n chia)
CREATE TABLE group_expense_shares (
    id UUID PRIMARY KEY,
    expense_id UUID REFERENCES group_expenses(id) ON DELETE CASCADE,
    member_id VARCHAR(255) NOT NULL,       -- Ai chá»‹u pháº§n nÃ y
    amount NUMERIC(18,2) NOT NULL          -- Sá»‘ tiá»n pháº£i chá»‹u
);
```

---

## ğŸ”„ Luá»“ng Hoáº¡t Äá»™ng

### 1. Táº¡o NhÃ³m

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Táº O NHÃ“M Má»šI                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  User A gá»i: POST /groups                                       â”‚
â”‚  {                                                              â”‚
â”‚    "name": "Chuyáº¿n Ä‘i ÄÃ  Láº¡t",                                 â”‚
â”‚    "ownerName": "Minh",           â† TÃªn hiá»ƒn thá»‹ cá»§a owner     â”‚
â”‚    "memberNames": ["Lan", "HÃ¹ng", "Mai"]                       â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  â†“                                                              â”‚
â”‚                                                                 â”‚
â”‚  Há»‡ thá»‘ng táº¡o:                                                  â”‚
â”‚  â€¢ Group: { code: "ABC123", createdByUserId: "user-A" }        â”‚
â”‚  â€¢ Members:                                                     â”‚
â”‚    - { name: "Minh", userId: "user-A", joined: true }  â† Owner â”‚
â”‚    - { name: "Lan", userId: null, joined: false }              â”‚
â”‚    - { name: "HÃ¹ng", userId: null, joined: false }             â”‚
â”‚    - { name: "Mai", userId: null, joined: false }              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Request:**
```bash
curl -X POST http://localhost:3004/groups \
  -H "Content-Type: application/json" \
  -H "x-user-id: user-A-uuid" \
  -d '{
    "name": "Chuyáº¿n Ä‘i ÄÃ  Láº¡t",
    "ownerName": "Minh",
    "memberNames": ["Lan", "HÃ¹ng", "Mai"]
  }'
```

**Response:**
```json
{
  "id": "group-uuid",
  "name": "Chuyáº¿n Ä‘i ÄÃ  Láº¡t",
  "code": "ABC123",
  "createdByUserId": "user-A-uuid",
  "isLocked": false,
  "members": [
    { "id": 1, "name": "Minh", "userId": "user-A-uuid", "joined": true, "joinedAt": "2025-12-15T10:00:00Z" },
    { "id": 2, "name": "Lan", "userId": null, "joined": false, "joinedAt": null },
    { "id": 3, "name": "HÃ¹ng", "userId": null, "joined": false, "joinedAt": null },
    { "id": 4, "name": "Mai", "userId": null, "joined": false, "joinedAt": null }
  ]
}
```

---

### 2. Tham Gia NhÃ³m

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THAM GIA NHÃ“M                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  User B nháº­n code "ABC123" tá»« User A                           â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 1: Xem thÃ´ng tin nhÃ³m                                    â”‚
â”‚  GET /groups/join/ABC123                                        â”‚
â”‚  â†’ Hiá»ƒn thá»‹ danh sÃ¡ch members chÆ°a join                        â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 2: Chá»n slot vÃ  join                                     â”‚
â”‚  POST /groups/join/ABC123                                       â”‚
â”‚  { "memberId": "2" }  â† Chá»n slot "Lan"                        â”‚
â”‚                                                                 â”‚
â”‚  â†“                                                              â”‚
â”‚                                                                 â”‚
â”‚  Káº¿t quáº£:                                                       â”‚
â”‚  Member "Lan": { userId: "user-B", joined: true }              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Request Join:**
```bash
curl -X POST http://localhost:3004/groups/join/ABC123 \
  -H "Content-Type: application/json" \
  -H "x-user-id: user-B-uuid" \
  -d '{ "memberId": "2" }'
```

---

### 3. Táº¡o Chi TiÃªu NhÃ³m

#### 3.1. Chia Äá»u (Equal Split)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CHI TIÃŠU - CHIA Äá»€U                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Minh tráº£ 2,000,000Ä‘ tiá»n khÃ¡ch sáº¡n cho cáº£ nhÃ³m 4 ngÆ°á»i        â”‚
â”‚                                                                 â”‚
â”‚  POST /group-expenses/{groupId}                                 â”‚
â”‚  {                                                              â”‚
â”‚    "title": "KhÃ¡ch sáº¡n 2 Ä‘Ãªm",                                 â”‚
â”‚    "amount": 2000000,                                           â”‚
â”‚    "paidByMemberId": "1",        â† Minh tráº£                    â”‚
â”‚    "splitType": "equal",                                        â”‚
â”‚    "participantMemberIds": ["1", "2", "3", "4"]                â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  â†“                                                              â”‚
â”‚                                                                 â”‚
â”‚  Tá»± Ä‘á»™ng tÃ­nh:                                                  â”‚
â”‚  â€¢ Má»—i ngÆ°á»i: 2,000,000 / 4 = 500,000Ä‘                         â”‚
â”‚                                                                 â”‚
â”‚  Shares Ä‘Æ°á»£c táº¡o:                                               â”‚
â”‚  - Member 1 (Minh): 500,000Ä‘                                   â”‚
â”‚  - Member 2 (Lan):  500,000Ä‘                                   â”‚
â”‚  - Member 3 (HÃ¹ng): 500,000Ä‘                                   â”‚
â”‚  - Member 4 (Mai):  500,000Ä‘                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2. Chia Theo Sá»‘ Tiá»n (Exact Split)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CHI TIÃŠU - CHIA THEO Sá» TIá»€N                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Lan tráº£ 800,000Ä‘ tiá»n Äƒn, nhÆ°ng Minh Äƒn nhiá»u hÆ¡n             â”‚
â”‚                                                                 â”‚
â”‚  POST /group-expenses/{groupId}                                 â”‚
â”‚  {                                                              â”‚
â”‚    "title": "Ä‚n tá»‘i BBQ",                                      â”‚
â”‚    "amount": 800000,                                            â”‚
â”‚    "paidByMemberId": "2",        â† Lan tráº£                     â”‚
â”‚    "splitType": "exact",                                        â”‚
â”‚    "splits": [                                                  â”‚
â”‚      { "memberId": "1", "amount": 300000 },  â† Minh 300k       â”‚
â”‚      { "memberId": "2", "amount": 200000 },  â† Lan 200k        â”‚
â”‚      { "memberId": "3", "amount": 150000 },  â† HÃ¹ng 150k       â”‚
â”‚      { "memberId": "4", "amount": 150000 }   â† Mai 150k        â”‚
â”‚    ]                                                            â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Tá»•ng splits pháº£i = amount (800,000)                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3. Chia Theo Pháº§n TrÄƒm (Percent Split)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CHI TIÃŠU - CHIA THEO PHáº¦N TRÄ‚M                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  HÃ¹ng tráº£ 1,000,000Ä‘ thuÃª xe, chia theo tá»· lá»‡ sá»­ dá»¥ng          â”‚
â”‚                                                                 â”‚
â”‚  POST /group-expenses/{groupId}                                 â”‚
â”‚  {                                                              â”‚
â”‚    "title": "ThuÃª xe 7 chá»—",                                   â”‚
â”‚    "amount": 1000000,                                           â”‚
â”‚    "paidByMemberId": "3",        â† HÃ¹ng tráº£                    â”‚
â”‚    "splitType": "percent",                                      â”‚
â”‚    "splits": [                                                  â”‚
â”‚      { "memberId": "1", "percent": 30 },   â† Minh 30%          â”‚
â”‚      { "memberId": "2", "percent": 25 },   â† Lan 25%           â”‚
â”‚      { "memberId": "3", "percent": 25 },   â† HÃ¹ng 25%          â”‚
â”‚      { "memberId": "4", "percent": 20 }    â† Mai 20%           â”‚
â”‚    ]                                                            â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Tá»•ng percent pháº£i = 100%                                   â”‚
â”‚                                                                 â”‚
â”‚  Tá»± Ä‘á»™ng tÃ­nh:                                                  â”‚
â”‚  - Minh: 1,000,000 Ã— 30% = 300,000Ä‘                            â”‚
â”‚  - Lan:  1,000,000 Ã— 25% = 250,000Ä‘                            â”‚
â”‚  - HÃ¹ng: 1,000,000 Ã— 25% = 250,000Ä‘                            â”‚
â”‚  - Mai:  1,000,000 Ã— 20% = 200,000Ä‘                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. TÃ­nh Balance (Ai Ná»£ Ai)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TÃNH TOÃN BALANCE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  GET /group-expenses/{groupId}/balance                          â”‚
â”‚                                                                 â”‚
â”‚  CÃ´ng thá»©c:                                                     â”‚
â”‚  Net = (Tá»•ng Ä‘Ã£ chi tráº£) - (Tá»•ng pháº§n pháº£i chá»‹u)               â”‚
â”‚                                                                 â”‚
â”‚  â€¢ Net > 0: ÄÆ°á»£c nháº­n tiá»n (ngÆ°á»i khÃ¡c ná»£ mÃ¬nh)                â”‚
â”‚  â€¢ Net < 0: Äang ná»£ tiá»n (mÃ¬nh ná»£ ngÆ°á»i khÃ¡c)                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### VÃ­ Dá»¥ TÃ­nh Balance

```
ğŸ“Š Tá»•ng káº¿t chi tiÃªu chuyáº¿n Ä‘i:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Khoáº£n chi          â”‚ Sá»‘ tiá»n      â”‚ NgÆ°á»i tráº£  â”‚ Chia Ä‘á»u 4 ng  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ KhÃ¡ch sáº¡n          â”‚ 2,000,000    â”‚ Minh       â”‚ 500k/ngÆ°á»i     â”‚
â”‚ Ä‚n tá»‘i BBQ         â”‚   800,000    â”‚ Lan        â”‚ 200k/ngÆ°á»i     â”‚
â”‚ ThuÃª xe            â”‚ 1,000,000    â”‚ HÃ¹ng       â”‚ 250k/ngÆ°á»i     â”‚
â”‚ VÃ© tham quan       â”‚   400,000    â”‚ Minh       â”‚ 100k/ngÆ°á»i     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tá»•ng: 4,200,000Ä‘ â†’ Má»—i ngÆ°á»i pháº£i chá»‹u: 1,050,000Ä‘

ğŸ“ˆ TÃ­nh Net cho tá»«ng ngÆ°á»i:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NgÆ°á»i  â”‚ ÄÃ£ chi tráº£      â”‚ Pháº§n pháº£i chá»‹u  â”‚ Net             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Minh   â”‚ 2,400,000       â”‚ 1,050,000       â”‚ +1,350,000 ğŸ’°   â”‚
â”‚ Lan    â”‚   800,000       â”‚ 1,050,000       â”‚   -250,000 ğŸ“‰   â”‚
â”‚ HÃ¹ng   â”‚ 1,000,000       â”‚ 1,050,000       â”‚    -50,000 ğŸ“‰   â”‚
â”‚ Mai    â”‚         0       â”‚ 1,050,000       â”‚ -1,050,000 ğŸ“‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Response API:**
```json
{
  "netList": [
    { "memberId": "1", "net": 1350000 },
    { "memberId": "2", "net": -250000 },
    { "memberId": "3", "net": -50000 },
    { "memberId": "4", "net": -1050000 }
  ]
}
```

---

### 5. RÃºt Gá»n Ná»£ (Simplify)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RÃšT Gá»ŒN Ná»¢ (SIMPLIFY)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Thay vÃ¬:                                                       â”‚
â”‚  â€¢ Lan â†’ Minh: 250,000                                         â”‚
â”‚  â€¢ HÃ¹ng â†’ Minh: 50,000                                         â”‚
â”‚  â€¢ Mai â†’ Minh: 1,050,000                                       â”‚
â”‚                                                                 â”‚
â”‚  Thuáº­t toÃ¡n simplify tá»‘i Æ°u sá»‘ giao dá»‹ch:                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Mai  â”€â”€â”€â”€ 1,050,000Ä‘ â”€â”€â”€â”€â–¶  Minh      â”‚                   â”‚
â”‚  â”‚  Lan  â”€â”€â”€â”€   250,000Ä‘ â”€â”€â”€â”€â–¶  Minh      â”‚                   â”‚
â”‚  â”‚  HÃ¹ng â”€â”€â”€â”€    50,000Ä‘ â”€â”€â”€â”€â–¶  Minh      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                 â”‚
â”‚  Tá»•ng: 3 giao dá»‹ch (tá»‘i Æ°u nháº¥t cÃ³ thá»ƒ)                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Response API:**
```json
{
  "netList": [
    { "memberId": "1", "net": 1350000 },
    { "memberId": "2", "net": -250000 },
    { "memberId": "3", "net": -50000 },
    { "memberId": "4", "net": -1050000 }
  ],
  "simplified": [
    { "fromMemberId": "4", "toMemberId": "1", "amount": 1050000 },
    { "fromMemberId": "2", "toMemberId": "1", "amount": 250000 },
    { "fromMemberId": "3", "toMemberId": "1", "amount": 50000 }
  ]
}
```

---

## ğŸ“¡ API Endpoints

### Group Service (Port 3004)

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| `POST` | `/groups` | Táº¡o nhÃ³m má»›i |
| `GET` | `/groups/join/:code` | Xem thÃ´ng tin nhÃ³m theo code |
| `POST` | `/groups/join/:code` | Tham gia nhÃ³m |
| `GET` | `/groups/my` | Láº¥y danh sÃ¡ch nhÃ³m cá»§a user |

### Transaction Service - Group Expense (Port 3001)

| Method | Endpoint | MÃ´ táº£ |
|--------|----------|-------|
| `POST` | `/group-expenses/:groupId` | Táº¡o chi tiÃªu má»›i |
| `GET` | `/group-expenses/:groupId` | Láº¥y danh sÃ¡ch chi tiÃªu cá»§a nhÃ³m |
| `GET` | `/group-expenses/:groupId/balance` | TÃ­nh balance vÃ  simplify |
| `DELETE` | `/group-expenses/:groupId/:expenseId` | XÃ³a chi tiÃªu |

---

## ğŸ”§ Cáº¥u HÃ¬nh

### Environment Variables

```env
# Group Service
GROUP_SERVICE_PORT=3004
GROUP_SERVICE_URL=http://group-service:3004

# Database (shared)
DATABASE_URL=postgresql://user:pass@localhost:5432/myfinance_db

# JWT (shared)
JWT_SECRET=your-secret-key
```

---

## ğŸ“ Notes

1. **Member ID vs User ID**: 
   - `memberId` lÃ  ID trong báº£ng `group_members` (slot trong nhÃ³m)
   - `userId` lÃ  ID user thá»±c sá»± (tá»« auth service)
   - Má»™t slot cÃ³ thá»ƒ chÆ°a cÃ³ user (khi chÆ°a ai join vÃ o slot Ä‘Ã³)

2. **Split Types**:
   - `equal`: Chia Ä‘á»u cho táº¥t cáº£ participants
   - `exact`: Chá»‰ Ä‘á»‹nh sá»‘ tiá»n cá»¥ thá»ƒ cho tá»«ng ngÆ°á»i
   - `percent`: Chá»‰ Ä‘á»‹nh % cho tá»«ng ngÆ°á»i

3. **Simplify Algorithm**: Sá»­ dá»¥ng greedy algorithm Ä‘á»ƒ tá»‘i Æ°u sá»‘ giao dá»‹ch thanh toÃ¡n

4. **Precision**: Sá»­ dá»¥ng cents (sá»‘ nguyÃªn) Ä‘á»ƒ trÃ¡nh lá»—i floating point khi chia tiá»n
